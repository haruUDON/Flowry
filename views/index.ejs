<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>サイト</title>
    <link rel="stylesheet" type="text/css" href="/stylesheet/index.css">
</head>

<body>
  <ul class="menu">
    <li title="home"><a class="active access-home">ホーム</a></li>
    <li title="search"><a href="#" class="access-search">検索</a></li>
    <li title="notifications">
      <a href="/notifications" class="access-notification">通知</a>
      <div class="notifications-count-badge">
        <span class="notifications-count-number"></span>
      </div>
    </li>
    <li title="profile"><a href="/profile/<%= user._id %>" class="access-profile">プロフィール</a></li>
    <li title="bookmarks"><a href="/bookmarks" class="access-bookmark">ブックマーク</a></li>
    <li title="messages"><a href="#" class="access-message">メッセージ</a></li>
  </ul>
  <div class="container">
    <% posts.forEach((post) => { %>
      <div class="post" id="post" onclick="redirectToURL('/post/<%= post._id %>')">
        <div class="post-flex">
          <div class="post-left">
            <div class="post-icon-container">
              <img src="data:image/jpeg;base64, <%= post.user.icon %>" alt="Icon" class="icon-img">
            </div>
          </div>
          <div class="post-right">
            <p class="post-detail">
              <span><a href="/profile/<%= post.user.id %>" class="display-name"><%= post.user.display_name.length > 20 ? post.user.display_name.slice(0, 20) + '...' : post.user.display_name %></a></span>
              <span class="timestamp">
                <%= Math.floor((new Date() - post.uploaded_at) / (1000 * 60 * 60)) %>時間
              </span>
            </p>
            <button class="fa-solid fa-ellipsis post-menu-button"></button>
            <div class="popup-menu">
              <% if(post.user.email === user.email){ %>
                <button class="fa-regular fa-trash-can menu-delete-button" data-postid="<%= post._id %>"> 削除</button>
              <% }; %>
            </div>
            <span class="post-content"><%= post.text %></span>
            <div class="reaction-box">
              <div class="flex">
                <div class="reaction-child-box">
                  <button class="fa-regular fa-comment post-comment"></button>
                </div>
                <div class="reaction-child-box">
                  <% if(user.liked_posts.includes(post._id)){ %>
                    <button class="fa-solid fa-heart post-like" data-postid="<%= post._id %>"></button>
                  <% } else { %>
                    <button class="fa-regular fa-heart post-like" data-postid="<%= post._id %>"></button>
                  <% } %>
                  <span>
                    <% if(post.likes.length > 0){ %>
                      <%= post.likes.length %>
                    <% } %>
                  </span>
                </div>
                <div class="reaction-child-box">
                  <% if(user.bookmarked_posts.includes(post._id)){ %>
                    <button class="fa-solid fa-bookmark post-bookmark" data-postid="<%= post._id %>"></button>
                  <% } else { %>
                    <button class="fa-regular fa-bookmark post-bookmark" data-postid="<%= post._id %>"></button>
                  <% } %>
                  <span>
                    <% if(post.bookmarks.length > 0){ %>
                      <%= post.bookmarks.length %>
                    <% } %>
                  </span>
                </div>
                <div class="reaction-child-box">
                  <button class="fa-solid fa-arrow-up-from-bracket post-share"></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% }); %>
  </div>
  <button id="show-post-form">投稿</button>
  <div class="background-post-form"></div>
  <div class="post-form">
    <button id="close-post-form">✖</button>
    <form action="/post" method="POST">
      <textarea placeholder="何かを投稿..." name="text"></textarea>
      <button type="submit">投稿</button>
    </form>
  </div>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="/javascript/index.js"></script>
</body>

</html>